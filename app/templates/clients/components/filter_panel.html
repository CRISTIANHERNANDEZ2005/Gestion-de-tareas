<!-- Filter Panel Component -->
<div id="filter-panel" class="filter-panel">
    <div class="filter-panel-header">
        <h3>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
            </svg>
            Filtros y Búsqueda
        </h3>
        <button id="close-filter-panel" class="btn-close-panel">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    
    <div class="filter-panel-content">
        <div class="filter-group">
            <label for="search-tasks">Buscar tareas</label>
            <div class="search-container">
                <input type="text" id="search-tasks" placeholder="Buscar por título o descripción..." class="form-control">
                <button onclick="window.tasksModule.aplicarFiltros()" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </div>
        </div>
        
        <div class="filter-group">
            <label>Rango de fechas</label>
            <div class="date-range-container">
                <div class="date-input-group">
                    <input type="date" id="date-from" class="form-control" placeholder="Desde">
                </div>
                <div class="date-input-group">
                    <input type="date" id="date-to" class="form-control" placeholder="Hasta">
                </div>
            </div>
        </div>
        
        <div class="filter-group">
            <label>Ordenar por</label>
            <div class="sort-container">
                <select id="sort-by" class="form-control" onchange="window.tasksModule.ordenarTareas(this.value, document.getElementById('sort-order').value)">
                    <option value="creado_en">Fecha de creación</option>
                    <option value="titulo">Título</option>
                    <option value="fecha_limite">Fecha límite</option>
                </select>
                
                <select id="sort-order" class="form-control" onchange="window.tasksModule.ordenarTareas(document.getElementById('sort-by').value, this.value)">
                    <option value="desc">Descendente</option>
                    <option value="asc">Ascendente</option>
                </select>
            </div>
        </div>
        
        <div class="filter-actions">
            <button onclick="window.tasksModule.aplicarFiltros()" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
                </svg>
                Aplicar
            </button>
            <button onclick="window.tasksModule.limpiarFiltros()" class="btn btn-outline">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="1 4 1 10 7 10"></polyline>
                    <polyline points="23 20 23 14 17 14"></polyline>
                    <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                </svg>
                Limpiar
            </button>
        </div>
    </div>
</div>

<!-- Floating Toggle Button -->
<button id="toggle-filter-panel" class="floating-filter-btn">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="4" y1="21" x2="4" y2="14"></line>
        <line x1="4" y1="10" x2="4" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12" y2="3"></line>
        <line x1="20" y1="21" x2="20" y2="16"></line>
        <line x1="20" y1="12" x2="20" y2="3"></line>
        <line x1="1" y1="14" x2="7" y2="14"></line>
        <line x1="9" y1="8" x2="15" y2="8"></line>
        <line x1="17" y1="16" x2="23" y2="16"></line>
    </svg>
</button>

<script>
    // Initialize filter panel functionality
    document.addEventListener('DOMContentLoaded', function() {
        const filterPanel = document.getElementById('filter-panel');
        const toggleButton = document.getElementById('toggle-filter-panel');
        const closeButton = document.getElementById('close-filter-panel');
        let touchStartX = 0;
        let touchEndX = 0;
        
        // Toggle filter panel visibility
        toggleButton.addEventListener('click', function() {
            filterPanel.classList.toggle('open');
        });
        
        // Close filter panel
        closeButton.addEventListener('click', function() {
            filterPanel.classList.remove('open');
        });
        
        // Close panel when clicking outside
        document.addEventListener('click', function(event) {
            if (!filterPanel.contains(event.target) && 
                event.target !== toggleButton && 
                !toggleButton.contains(event.target)) {
                filterPanel.classList.remove('open');
            }
        });
        
        // Add functionality for search on Enter key
        document.getElementById('search-tasks').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                window.tasksModule.aplicarFiltros();
            }
        });
        
        // Apply filters when dates change with debounce
        document.getElementById('date-from').addEventListener('change', function() {
            window.tasksModule.aplicarFiltrosDebounce();
        });
        
        document.getElementById('date-to').addEventListener('change', function() {
            window.tasksModule.aplicarFiltrosDebounce();
        });
        
        // Add debounce to search input
        let searchDebounceTimer;
        document.getElementById('search-tasks').addEventListener('input', function(e) {
            clearTimeout(searchDebounceTimer);
            searchDebounceTimer = setTimeout(() => {
                window.tasksModule.aplicarFiltrosDebounce();
            }, 300);
        });
        
        // Add swipe gesture support for mobile
        filterPanel.addEventListener('touchstart', function(event) {
            touchStartX = event.changedTouches[0].screenX;
        }, false);
        
        filterPanel.addEventListener('touchend', function(event) {
            touchEndX = event.changedTouches[0].screenX;
            handleSwipeGesture();
        }, false);
        
        function handleSwipeGesture() {
            const swipeThreshold = 50;
            
            // Swipe right to close panel
            if (touchEndX > touchStartX + swipeThreshold) {
                filterPanel.classList.remove('open');
            }
        }
    });
</script>